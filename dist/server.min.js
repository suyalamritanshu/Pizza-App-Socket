"use strict";require("dotenv").config();var express=require("express"),app=express(),ejs=require("ejs"),path=require("path"),expressLayout=require("express-ejs-layouts"),port=process.env.PORT||3e3,mongoose=require("mongoose"),session=require("express-session"),flash=require("express-flash"),MongoDbStore=require("connect-mongo"),passport=require("passport"),Emitter=require("events");mongoose.connect(process.env.MONGO_CONNECTION_URL,{useNewUrlParser:!0,useCreateIndex:!0,useUnifiedTopology:!0,useFindAndModify:!0});var connection=mongoose.connection;connection.once("open",function(){console.log("Database connected...")}).catch(function(e){console.log("Connection failed...")});var eventEmitter=new Emitter;app.set("eventEmitter",eventEmitter),app.use(session({secret:process.env.COOKIE_SECRET,resave:!1,store:MongoDbStore.create({mongoUrl:process.env.MONGO_CONNECTION_URL}),saveUninitialized:!1,cookie:{maxAge:864e5}}));var passportInit=require("./app/config/passport");passportInit(passport),app.use(passport.initialize()),app.use(passport.session()),app.use(flash()),app.use(express.static("public")),app.use(express.urlencoded({extended:!1})),app.use(express.json()),app.use(function(e,s,o){s.locals.session=e.session,s.locals.user=e.user,o()}),app.use(expressLayout),app.set("views",path.join(__dirname,"/resources/views")),app.set("view engine","ejs"),require("./routes/web")(app),app.use(function(e,s){s.status(404).render("errors/404")});var server=app.listen(port);console.log("Server listening on port "+port);var io=require("socket.io")(server);io.on("connection",function(s){s.on("join",function(e){s.join(e)})}),eventEmitter.on("orderUpdated",function(e){io.to("order_".concat(e.id)).emit("orderUpdated",e)}),eventEmitter.on("orderPlaced",function(e){io.to("adminRoom").emit("orderPlaced",e)});
//# sourceMappingURL=server.min.js.map
