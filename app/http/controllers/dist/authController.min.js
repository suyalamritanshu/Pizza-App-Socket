"use strict";var _require=require("express"),request=_require.request,passport=require("passport"),User=require("../../models/user"),bcrypt=require("bcrypt");function authController(){return{login:function(r,e){e.render("auth/login")},postLogin:function(n,s,a){var r=n.body,e=r.email,t=r.password;if(!e||!t)return n.flash("error","All fields are required"),s.redirect("/login");passport.authenticate("local",function(r,e,t){return r?(n.flash("error",t.message),a(r)):e?void n.logIn(e,function(r){return r?(n.flash("error",t.message),a(r)):s.redirect(function(r){return"admin"===r.user.role?"/admin/orders":"/customer/orders"}(n))}):(n.flash("error",t.message),s.redirect("/login"))})(n,s,a)},register:function(r,e){e.render("auth/register")},postRegister:function(t,n){var e,s,a,i,o;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(e=t.body,s=e.name,a=e.email,i=e.password,s&&a&&i){r.next=6;break}return t.flash("error","All fields are required"),t.flash("name",s),t.flash("email",a),r.abrupt("return",n.redirect("/register"));case 6:return User.exists({email:a},function(r,e){if(e)return t.flash("error","Email already taken"),t.flash("name",s),t.flash("email",a),n.redirect("/register")}),r.next=9,regeneratorRuntime.awrap(bcrypt.hash(i,10));case 9:o=r.sent,new User({name:s,email:a,password:o}).save().then(function(r){return n.redirect("/")}).catch(function(r){return t.flash("error","Something went wrong"),n.redirect("/register")});case 12:case"end":return r.stop()}})},logout:function(r,e){return r.logout(),e.redirect("/login")}}}module.exports=authController;
//# sourceMappingURL=authController.min.js.map
